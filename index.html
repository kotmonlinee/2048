<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2048 - Classic Number Merge Game</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Google Analytics (仅在正式环境加载) -->
    <script>
        // 检测当前环境是否为正式环境
        function isProductionEnvironment() {
            // 在开发环境中，我们使用 localhost 或 127.0.0.1
            // 在正式环境中，URL 通常是生产域名
            const hostname = window.location.hostname;
            return !['localhost', '127.0.0.1'].includes(hostname) && 
                   !hostname.startsWith('192.168.') && 
                   !hostname.startsWith('10.');
        }
        
        // 仅在正式环境中加载和初始化Google Analytics
        if (isProductionEnvironment()) {
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', 'G-RZ7NVN15FH');
            
            // 动态加载Google Analytics脚本
            const gaScript = document.createElement('script');
            gaScript.async = true;
            gaScript.src = 'https://www.googletagmanager.com/gtag/js?id=G-RZ7NVN15FH';
            document.head.appendChild(gaScript);
        }
        
        if (isProductionEnvironment()) {
            (function(c,l,a,r,i,t,y){
                c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
                t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
                y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
            })(window, document, "clarity", "script", "t4xrbdcgr8");
        }

    </script>
    
    <!-- Tailwind 配置 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#FF6B6B',
                        secondary: '#4ECDC4',
                        accent: '#FFD166',
                        dark: '#292F36',
                        light: '#F7FFF7',
                        // 2048方块颜色
                        'tile-0': '#CDC1B4',
                        'tile-2': '#EEE4DA',
                        'tile-4': '#EDE0C8',
                        'tile-8': '#F2B179',
                        'tile-16': '#F59563',
                        'tile-32': '#F67C5F',
                        'tile-64': '#F65E3B',
                        'tile-128': '#EDCF72',
                        'tile-256': '#EDCC61',
                        'tile-512': '#EDC850',
                        'tile-1024': '#EDC53F',
                        'tile-2048': '#EDC22E',
                    },
                    fontFamily: {
                        poppins: ['Poppins', 'sans-serif'],
                    },
                },
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .text-shadow {
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
            }
            .transition-transform-opacity {
                transition-property: transform, opacity;
            }
            .grid-4x4 {
                grid-template-columns: repeat(4, minmax(0, 1fr));
                grid-template-rows: repeat(4, minmax(0, 1fr));
            }
            .perspective {
                perspective: 1000px;
            }
            .preserve-3d {
                transform-style: preserve-3d;
            }
            /* 动画类 */
            .animate-pulse {
                animation: pulse 0.5s cubic-bezier(0.4, 0, 0.6, 1) infinite;
            }
            .animate-pop {
                animation: pop 0.2s cubic-bezier(0.4, 0, 0.6, 1);
            }
            /* 倒计时动画 - 快结束时的视觉提醒 */
            .animate-countdown-warning {
                animation: countdownWarning 1s cubic-bezier(0.4, 0, 0.6, 1) infinite alternate;
            }
            /* 准备倒计时动画 */
            .animate-ready-countdown {
                animation: readyCountdown 1s cubic-bezier(0.4, 0, 0.6, 1);
            }
            @keyframes pulse {
                0%, 100% {
                    opacity: 1;
                }
                50% {
                    opacity: 0.7;
                }
            }
            @keyframes pop {
                0% {
                    transform: scale(0.8);
                    opacity: 0;
                }
                50% {
                    transform: scale(1.1);
                }
                100% {
                    transform: scale(1);
                    opacity: 1;
                }
            }
            @keyframes countdownWarning {
                0% {
                    background-color: #FF6B6B;
                    transform: scale(1);
                }
                100% {
                    background-color: #FF3B30;
                    transform: scale(1.05);
                }
            }
            @keyframes readyCountdown {
                0% {
                    transform: scale(1.5);
                    opacity: 0;
                }
                50% {
                    transform: scale(1.1);
                }
                100% {
                    transform: scale(1);
                    opacity: 1;
                }
            }
        }
    </style>
</head>
<body class="font-poppins bg-gradient-to-br from-light to-secondary min-h-screen flex flex-col justify-between">
    <!-- 游戏容器 -->
    <div class="container mx-auto px-4 py-8 max-w-3xl">
        <!-- 头部区域 -->
        <header class="flex flex-col md:flex-row justify-between items-center mb-8">
            <div class="flex space-x-4">
                <!-- 分数显示 -->
                <div class="bg-dark/80 text-light rounded-lg px-4 py-3 text-center">
                    <div class="text-xs uppercase tracking-wider">Score</div>
                    <div id="score" class="text-2xl font-bold">0</div>
                </div>
                
                <!-- 最高分显示 -->
                <div class="bg-dark/80 text-light rounded-lg px-4 py-3 text-center">
                    <div class="text-xs uppercase tracking-wider">Best</div>
                    <div id="best-score" class="text-2xl font-bold">0</div>
                </div>
                
                <!-- 倒计时显示 - 固定宽度 -->
                <div id="timer" class="bg-primary text-white rounded-lg px-4 py-3 text-center shadow-lg transform transition-all duration-500 w-32">
                    <div class="text-xs uppercase tracking-wider">Time Left</div>
                    <div id="countdown" class="text-2xl font-bold">30</div>
                </div>
            </div>
        </header>
        
        <!-- 控制按钮区域 -->
        <!-- <div class="flex justify-center mb-6 space-x-4">
            <button id="new-game" class="bg-primary hover:bg-primary/90 text-white font-bold py-2 px-6 rounded-lg transition-all transform hover:scale-105 shadow-lg flex items-center">
                <i class="fa fa-refresh mr-2"></i> New Game
            </button>
        </div> -->
        
        <!-- 游戏棋盘 -->
        <div class="relative w-full max-w-4xl mx-auto mb-8" style="aspect-ratio: 5/7;">
            <!-- 棋盘背景 -->
            <div id="game-board" class="absolute inset-0 bg-dark/20 rounded-xl grid gap-3 p-4 transition-all duration-300">
                <!-- 空白格子 -->
                  <div class="bg-tile-0/80 rounded-lg"></div>
                  <div class="bg-tile-0/80 rounded-lg"></div>
                  <div class="bg-tile-0/80 rounded-lg"></div>
                  <div class="bg-tile-0/80 rounded-lg"></div>
                  <div class="bg-tile-0/80 rounded-lg"></div>
                  <div class="bg-tile-0/80 rounded-lg"></div>
                  <div class="bg-tile-0/80 rounded-lg"></div>
                  <div class="bg-tile-0/80 rounded-lg"></div>
                  <div class="bg-tile-0/80 rounded-lg"></div>
                  <div class="bg-tile-0/80 rounded-lg"></div>
                  <div class="bg-tile-0/80 rounded-lg"></div>
                  <div class="bg-tile-0/80 rounded-lg"></div>
                  <div class="bg-tile-0/80 rounded-lg"></div>
                  <div class="bg-tile-0/80 rounded-lg"></div>
                  <div class="bg-tile-0/80 rounded-lg"></div>
                  <div class="bg-tile-0/80 rounded-lg"></div>
                  <div class="bg-tile-0/80 rounded-lg"></div>
                  <div class="bg-tile-0/80 rounded-lg"></div>
                  <div class="bg-tile-0/80 rounded-lg"></div>
                  <div class="bg-tile-0/80 rounded-lg"></div>
                  <div class="bg-tile-0/80 rounded-lg"></div>
                  <div class="bg-tile-0/80 rounded-lg"></div>
                  <div class="bg-tile-0/80 rounded-lg"></div>
                  <div class="bg-tile-0/80 rounded-lg"></div>
                  <div class="bg-tile-0/80 rounded-lg"></div>
                  <div class="bg-tile-0/80 rounded-lg"></div>
                  <div class="bg-tile-0/80 rounded-lg"></div>
                  <div class="bg-tile-0/80 rounded-lg"></div>
                  <div class="bg-tile-0/80 rounded-lg"></div>
                  <div class="bg-tile-0/80 rounded-lg"></div>
                  <div class="bg-tile-0/80 rounded-lg"></div>
                  <div class="bg-tile-0/80 rounded-lg"></div>
                  <div class="bg-tile-0/80 rounded-lg"></div>
                  <div class="bg-tile-0/80 rounded-lg"></div>
                  <div class="bg-tile-0/80 rounded-lg"></div>
                  <div class="bg-tile-0/80 rounded-lg"></div>
                  <div class="bg-tile-0/80 rounded-lg"></div>
                  <div class="bg-tile-0/80 rounded-lg"></div>
            </div>
        </div>
        
        <!-- 欢迎弹窗 (居中显示，不覆盖棋盘) -->
        <div id="welcome-screen" class="fixed inset-0 flex items-center justify-center z-50 p-4">
            <div class="bg-gradient-to-br from-primary to-secondary rounded-2xl p-8 max-w-md w-full shadow-2xl transform transition-all duration-300">
                <h2 class="text-[clamp(1.8rem,3vw,2.5rem)] font-bold text-white mb-4 text-center text-shadow">2048 Time Challenge</h2>
                <p class="text-white text-lg mb-6 text-center px-4">
                    Merge to 2048 within 30 seconds! Challenge your limits!<br>Unlock more features after success!
                </p>
                <div class="flex justify-center">
                    <button id="start-challenge" class="bg-accent hover:bg-accent/90 text-dark font-bold py-3 px-8 rounded-lg transition-all transform hover:scale-105 shadow-lg text-lg">
                        Start Challenge
                    </button>
                </div>
            </div>
        </div>
            
            <!-- 倒计时准备界面 -->
            <div id="countdown-screen" class="absolute inset-0 bg-dark/90 rounded-xl flex flex-col justify-center items-center z-20 opacity-0 pointer-events-none transition-opacity duration-500">
                <div id="ready-countdown" class="text-[clamp(5rem,15vw,8rem)] font-bold text-white mb-6">3</div>
                <p class="text-light text-xl">Get Ready!</p>
            </div>
            
            <!-- 棋盘背景 -->
            <div id="game-board" class="absolute inset-0 bg-dark/20 rounded-xl grid gap-3 p-4 transition-all duration-300 opacity-0 pointer-events-none">
                <!-- 空白格子 -->
                  <div class="bg-tile-0/80 rounded-lg"></div>
                  <div class="bg-tile-0/80 rounded-lg"></div>
                  <div class="bg-tile-0/80 rounded-lg"></div>
                  <div class="bg-tile-0/80 rounded-lg"></div>
                  <div class="bg-tile-0/80 rounded-lg"></div>
                  <div class="bg-tile-0/80 rounded-lg"></div>
                  <div class="bg-tile-0/80 rounded-lg"></div>
                  <div class="bg-tile-0/80 rounded-lg"></div>
                  <div class="bg-tile-0/80 rounded-lg"></div>
                  <div class="bg-tile-0/80 rounded-lg"></div>
                  <div class="bg-tile-0/80 rounded-lg"></div>
                  <div class="bg-tile-0/80 rounded-lg"></div>
                  <div class="bg-tile-0/80 rounded-lg"></div>
                  <div class="bg-tile-0/80 rounded-lg"></div>
                  <div class="bg-tile-0/80 rounded-lg"></div>
                  <div class="bg-tile-0/80 rounded-lg"></div>
                  <div class="bg-tile-0/80 rounded-lg"></div>
                  <div class="bg-tile-0/80 rounded-lg"></div>
                  <div class="bg-tile-0/80 rounded-lg"></div>
                  <div class="bg-tile-0/80 rounded-lg"></div>
                  <div class="bg-tile-0/80 rounded-lg"></div>
                  <div class="bg-tile-0/80 rounded-lg"></div>
                  <div class="bg-tile-0/80 rounded-lg"></div>
                  <div class="bg-tile-0/80 rounded-lg"></div>
                  <div class="bg-tile-0/80 rounded-lg"></div>
                  <div class="bg-tile-0/80 rounded-lg"></div>
                  <div class="bg-tile-0/80 rounded-lg"></div>
                  <div class="bg-tile-0/80 rounded-lg"></div>
                  <div class="bg-tile-0/80 rounded-lg"></div>
                  <div class="bg-tile-0/80 rounded-lg"></div>
                  <div class="bg-tile-0/80 rounded-lg"></div>
                  <div class="bg-tile-0/80 rounded-lg"></div>
                  <div class="bg-tile-0/80 rounded-lg"></div>
                  <div class="bg-tile-0/80 rounded-lg"></div>
                  <div class="bg-tile-0/80 rounded-lg"></div>
                  <div class="bg-tile-0/80 rounded-lg"></div>
                  <div class="bg-tile-0/80 rounded-lg"></div>
                  <div class="bg-tile-0/80 rounded-lg"></div>
            </div>
            
            <!-- 游戏结束遮罩 - 支持成功/失败两种状态 -->
            <div id="game-over" class="absolute inset-0 bg-dark/80 rounded-xl flex flex-col justify-center items-center opacity-0 pointer-events-none transition-opacity duration-500 z-10">
                <h2 id="game-over-title" class="text-[clamp(1.5rem,3vw,2.5rem)] font-bold text-white mb-4">游戏结束！</h2>
                <p id="game-over-message" class="text-light mb-6 text-center px-4">挑战失败了？下载完整游戏体验更多精彩内容！</p>
                <div class="flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-4">
                    <button id="restart-game" class="bg-primary hover:bg-primary/90 text-white font-bold py-3 px-8 rounded-lg transition-all transform hover:scale-105 shadow-lg">
                        Play Again
                    </button>
                    <a href="https://play.google.com/store" target="_blank" id="download-app" class="bg-accent hover:bg-accent/90 text-dark font-bold py-3 px-8 rounded-lg transition-all transform hover:scale-105 shadow-lg flex items-center justify-center">
                        <i class="fa fa-android mr-2"></i> Download Full Version
                    </a>
                </div>
            </div>
        </div>
        
        <!-- 游戏下载区域 -->
        <div class="bg-white/80 backdrop-blur-sm rounded-xl p-6 shadow-xl mb-8">
            <div class="flex flex-col md:flex-row items-center justify-between">
                <div class="mb-4 md:mb-0">
                    <h3 class="text-xl font-bold text-dark mb-2">Enjoying the game?</h3>
                    <p class="text-gray-600">Download the full version for more levels and features!</p>
                </div>
                <a href="https://play.google.com/store" target="_blank" id="download-app-btn" class="bg-accent hover:bg-accent/90 text-dark font-bold py-3 px-8 rounded-lg transition-all transform hover:scale-105 shadow-lg flex items-center justify-center">
                    <i class="fa fa-android mr-2 text-2xl"></i> Go to Google Play
                </a>
            </div>
        </div>
        

    </div>
    <!-- 游戏脚本 -->
    <script type="module" src="js/game.js"></script>
    <script type="module" src="js/ui.js"></script>
    <!-- URL参数处理脚本 -->
    <script type="module" src="js/paramsHandler.js"></script>
</body>
</html>